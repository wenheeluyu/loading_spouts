<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>溜筒选型问卷</title>
    <style>
        body {
            font-family: "Microsoft YaHei", sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1, h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        h1 {
            text-align: center;
            color: #2980b9;
        }

        .section {
            background: #fff;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #3498db;
        }

        label {
            display: block;
            margin: 12px 0 6px;
            font-weight: bold;
            color: #34495e;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }

        input:focus, select:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
        }

        .radio-group {
            margin: 10px 0;
        }

        .radio-group label {
            display: inline-block;
            font-weight: normal;
            margin-right: 20px;
            cursor: pointer;
        }

        .radio-group input {
            margin-right: 8px;
            transform: scale(1.2);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            margin-bottom: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        .submit-btn {
            display: block;
            width: 200px;
            padding: 15px;
            margin: 30px auto;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .submit-btn:hover {
            background-color: #2980b9;
        }

        .required::after {
            content: " *";
            color: red;
        }

        .instructions {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #f39c12;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .success-message {
            display: none;
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            text-align: center;
        }

        .error-message {
            display: none;
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>溜筒选型问卷</h1>
        
        <div class="instructions">
            <p><strong>说明：</strong>请完整填写以下问卷，带 <span style="color:red">*</span> 的字段为必填项。</p>
            <p>数据将自动提交到系统，同时提供本地备份下载。</p>
        </div>

        <div class="loading" id="loading">
            <p>正在提交数据，请稍候...</p>
        </div>

        <div class="success-message" id="success-message">
            <h3>✅ 提交成功！</h3>
            <p>数据已成功提交到系统，同时本地备份文件已下载。</p>
        </div>

        <div class="error-message" id="error-message">
            <h3>❌ 提交遇到问题</h3>
            <p id="error-text">网络连接不稳定，数据已保存到本地文件，请手动发送。</p>
        </div>

        <form id="questionnaire-form">
            <!-- 1. 项目背景 -->
            <div class="section">
                <h2>1、项目背景</h2>
                <label for="user-name" class="required">终端用户名称:</label>
                <input type="text" id="user-name" name="user-name" required>

                <label for="project-address" class="required">项目地址:</label>
                <input type="text" id="project-address" name="project-address" required>

                <label class="required">项目类型:</label>
                <div class="radio-group">
                    <label><input type="radio" name="project-type" value="A" required> A 新建</label>
                    <label><input type="radio" name="project-type" value="B"> B 改造升级</label>
                </div>
            </div>

            <!-- 2. 物料特性 -->
            <div class="section">
                <h2>2、物料特性</h2>
                <label for="material-name" class="required">物料名称:</label>
                <input type="text" id="material-name" name="material-name" required>

                <label for="particle-size" class="required">物料粒径范围:</label>
                <input type="text" id="particle-size" name="particle-size" placeholder="例如：0-10mm" required>

                <label for="material-density" class="required">物料比重 (kg/m³):</label>
                <input type="number" id="material-density" name="material-density" step="0.1" required>

                <label class="required">物料湿度:</label>
                <div class="radio-group">
                    <label><input type="radio" name="humidity" value="A" required> A 非常潮湿</label>
                    <label><input type="radio" name="humidity" value="B"> B 中等湿度</label>
                    <label><input type="radio" name="humidity" value="C"> C 轻微湿度</label>
                    <label><input type="radio" name="humidity" value="D"> D 无湿度</label>
                </div>

                <label class="required">物料磨蚀性:</label>
                <div class="radio-group">
                    <label><input type="radio" name="abrasiveness" value="A" required> A 非常强</label>
                    <label><input type="radio" name="abrasiveness" value="B"> B 中等</label>
                    <label><input type="radio" name="abrasiveness" value="C"> C 轻微</label>
                    <label><input type="radio" name="abrasiveness" value="D"> D 无</label>
                </div>

                <label class="required">物料粉尘:</label>
                <div class="radio-group">
                    <label><input type="radio" name="dust" value="A" required> A 非常多</label>
                    <label><input type="radio" name="dust" value="B"> B 中等</label>
                    <label><input type="radio" name="dust" value="C"> C 轻微</label>
                    <label><input type="radio" name="dust" value="D"> D 无</label>
                </div>
            </div>

            <!-- 3. 溜筒结构 -->
            <div class="section">
                <h2>3、溜筒结构</h2>

                <label class="required">内筒材质:</label>
                <div class="radio-group">
                    <label><input type="radio" name="inner-material" value="A" required> A 碳钢</label>
                    <label><input type="radio" name="inner-material" value="B"> B 不锈钢</label>
                    <label><input type="radio" name="inner-material" value="C"> C 耐磨钢</label>
                </div>

                <label class="required">防尘罩材质:</label>
                <div class="radio-group">
                    <label><input type="radio" name="dust-cover" value="A" required> A 涤纶</label>
                    <label><input type="radio" name="dust-cover" value="B"> B PVC</label>
                    <label><input type="radio" name="dust-cover" value="C"> C 海帕龙</label>
                </div>

                <label class="required">框架材质:</label>
                <div class="radio-group">
                    <label><input type="radio" name="frame-material" value="A" required> A 碳钢</label>
                    <label><input type="radio" name="frame-material" value="B"> B 不锈钢</label>
                </div>

                <label class="required">油漆颜色:</label>
                <div class="radio-group">
                    <label><input type="radio" name="paint-color" value="A" required> A 蓝色</label>
                    <label><input type="radio" name="paint-color" value="B"> B 其他指定</label>
                </div>

                <label class="required">入口法兰:</label>
                <div class="radio-group">
                    <label><input type="radio" name="flange-type" value="A" required> A 标准入口法兰</label>
                    <label><input type="radio" name="flange-type" value="B"> B 其他指定</label>
                </div>
            </div>

            <!-- 4. 电气控制 -->
            <div class="section">
                <h2>4、电气控制</h2>

                <label class="required">是否配置料位计:</label>
                <div class="radio-group">
                    <label><input type="radio" name="level-sensor" value="A" required> A 是</label>
                    <label><input type="radio" name="level-sensor" value="B"> B 否</label>
                </div>

                <label class="required">是否要求自动提升功能:</label>
                <div class="radio-group">
                    <label><input type="radio" name="auto-lift" value="A" required> A 是</label>
                    <label><input type="radio" name="auto-lift" value="B"> B 否</label>
                </div>
            </div>

            <!-- 5. 现场安装数据 -->
            <div class="section">
                <h2>5、现场安装数据</h2>

                <h3>卡车装车安装数据 (单位: mm)</h3>
                <table>
                    <tr>
                        <th>参数</th>
                        <th>尺寸 (mm)</th>
                    </tr>
                    <tr>
                        <td>H1</td>
                        <td><input type="number" name="truck-h1" required></td>
                    </tr>
                    <tr>
                        <td>H2</td>
                        <td><input type="number" name="truck-h2" required></td>
                    </tr>
                    <tr>
                        <td>H3</td>
                        <td><input type="number" name="truck-h3" required></td>
                    </tr>
                    <tr>
                        <td>A</td>
                        <td><input type="number" name="truck-a" required></td>
                    </tr>
                    <tr>
                        <td>B</td>
                        <td><input type="number" name="truck-b" required></td>
                    </tr>
                </table>

                <h3>罐车装车安装数据 (单位: mm)</h3>
                <table>
                    <tr>
                        <th>参数</th>
                        <th>尺寸 (mm)</th>
                    </tr>
                    <tr>
                        <td>H1</td>
                        <td><input type="number" name="tank-h1" required></td>
                    </tr>
                    <tr>
                        <td>H2</td>
                        <td><input type="number" name="tank-h2" required></td>
                    </tr>
                    <tr>
                        <td>A</td>
                        <td><input type="number" name="tank-a" required></td>
                    </tr>
                    <tr>
                        <td>B</td>
                        <td><input type="number" name="tank-b" required></td>
                    </tr>
                    <tr>
                        <td>C</td>
                        <td><input type="number" name="tank-c" required></td>
                    </tr>
                </table>
            </div>

            <button type="submit" class="submit-btn">提交问卷</button>
        </form>
    </div>

    <script>
        // Google Forms 配置 - 需要你修改的部分
        const GOOGLE_FORMS_CONFIG = {
            formUrl: 'https://docs.google.com/forms/d/e/YOUR_FORM_ID/formResponse',
            fieldMapping: {
                // 项目背景
                'user-name': 'entry.XXXXXXXXX', // 终端用户名称
                'project-address': 'entry.XXXXXXXXX', // 项目地址
                'project-type': 'entry.XXXXXXXXX', // 项目类型
                
                // 物料特性
                'material-name': 'entry.XXXXXXXXX', // 物料名称
                'particle-size': 'entry.XXXXXXXXX', // 物料粒径范围
                'material-density': 'entry.XXXXXXXXX', // 物料比重
                'humidity': 'entry.XXXXXXXXX', // 物料湿度
                'abrasiveness': 'entry.XXXXXXXXX', // 物料磨蚀性
                'dust': 'entry.XXXXXXXXX', // 物料粉尘
                
                // 溜筒结构
                'inner-material': 'entry.XXXXXXXXX', // 内筒材质
                'dust-cover': 'entry.XXXXXXXXX', // 防尘罩材质
                'frame-material': 'entry.XXXXXXXXX', // 框架材质
                'paint-color': 'entry.XXXXXXXXX', // 油漆颜色
                'flange-type': 'entry.XXXXXXXXX', // 入口法兰
                
                // 电气控制
                'level-sensor': 'entry.XXXXXXXXX', // 料位计配置
                'auto-lift': 'entry.XXXXXXXXX', // 自动提升功能
                
                // 现场安装数据
                'truck-h1': 'entry.XXXXXXXXX', // 卡车H1
                'truck-h2': 'entry.XXXXXXXXX', // 卡车H2
                'truck-h3': 'entry.XXXXXXXXX', // 卡车H3
                'truck-a': 'entry.XXXXXXXXX', // 卡车A
                'truck-b': 'entry.XXXXXXXXX', // 卡车B
                'tank-h1': 'entry.XXXXXXXXX', // 罐车H1
                'tank-h2': 'entry.XXXXXXXXX', // 罐车H2
                'tank-a': 'entry.XXXXXXXXX', // 罐车A
                'tank-b': 'entry.XXXXXXXXX', // 罐车B
                'tank-c': 'entry.XXXXXXXXX', // 罐车C
            }
        };

        document.getElementById('questionnaire-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // 显示加载状态
            showLoading();
            
            try {
                // 收集表单数据
                const formData = collectFormData();
                
                // 同时提交到Google Forms和下载本地备份
                await Promise.all([
                    submitToGoogleForms(formData),
                    downloadLocalBackup(formData)
                ]);
                
                // 显示成功消息
                showSuccess();
                
                // 3秒后重置表单
                setTimeout(() => {
                    this.reset();
                    hideMessages();
                }, 3000);
                
            } catch (error) {
                // 显示错误消息
                showError('提交失败：' + error.message);
                
                // 确保至少下载本地备份
                downloadLocalBackup(collectFormData());
            }
        });

        function collectFormData() {
            const formData = new FormData(document.getElementById('questionnaire-form'));
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            // 添加元数据
            data.timestamp = new Date().toISOString();
            data.submissionId = generateSubmissionId();
            data.userAgent = navigator.userAgent;
            
            return data;
        }

        async function submitToGoogleForms(data) {
            const formData = new FormData();
            
            // 映射数据到Google Forms字段
            for (const [fieldName, fieldValue] of Object.entries(data)) {
                const entryId = GOOGLE_FORMS_CONFIG.fieldMapping[fieldName];
                if (entryId && fieldValue) {
                    formData.append(entryId, fieldValue);
                }
            }
            
            // 提交到Google Forms
            const response = await fetch(GOOGLE_FORMS_CONFIG.formUrl, {
                method: 'POST',
                body: formData,
                mode: 'no-cors' // 注意：no-cors模式无法读取响应
            });
            
            // 由于no-cors模式，我们无法检测是否真正成功
            // 但大多数情况下会成功提交
            return true;
        }

        function downloadLocalBackup(data) {
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `溜筒选型问卷_${new Date().toISOString().split('T')[0]}_${data['user-name'] || '未知用户'}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            return true;
        }

        function generateSubmissionId() {
            return 'SUB_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6);
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('success-message').style.display = 'none';
            document.getElementById('error-message').style.display = 'none';
        }

        function showSuccess() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('success-message').style.display = 'block';
            document.getElementById('error-message').style.display = 'none';
        }

        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('success-message').style.display = 'none';
            document.getElementById('error-message').style.display = 'block';
            document.getElementById('error-text').textContent = message;
        }

        function hideMessages() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('success-message').style.display = 'none';
            document.getElementById('error-message').style.display = 'none';
        }
    </script>
</body>
</html>
